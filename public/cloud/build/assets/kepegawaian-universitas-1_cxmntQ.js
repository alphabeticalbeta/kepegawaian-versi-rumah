var g=(m,n)=>()=>(n||m((n={exports:{}}).exports,n),n.exports);var h=g((b,c)=>{class p{constructor(){this.init()}init(){this.setupCsrfToken(),this.initializeSidebar(),this.initializeDropdowns(),this.initializeDataTables(),this.initializeFormValidation(),this.initializeFileUploads(),this.initializeAlerts(),this.initializeValidationScripts(),this.initializeKepegawaianUniversitasButtons(),this.checkAndDisableButtons()}setupCsrfToken(){const n=document.querySelector('meta[name="csrf-token"]');n&&(window.csrfToken=n.getAttribute("content"),window.fetchWithCsrf=function(e,t={}){return t.headers=t.headers||{},t.headers["X-CSRF-TOKEN"]=window.csrfToken,t.headers["X-Requested-With"]="XMLHttpRequest",fetch(e,t)})}initializeIcons(){typeof lucide<"u"&&lucide.createIcons()}initializeSidebar(){const n=document.getElementById("sidebar"),e=document.getElementById("main-content");n&&e&&(window.toggleSidebar=()=>{const t=!n.classList.contains("w-20");n.classList.toggle("w-64",!t),n.classList.toggle("w-20",t),e.style.marginLeft=t?"5rem":"16rem",document.querySelectorAll(".sidebar-text").forEach(a=>{a.classList.toggle("hidden",t)}),t&&document.querySelectorAll(".dropdown-menu").forEach(a=>{a.classList.add("hidden");const o=document.querySelector(`[data-collapse-toggle="${a.id}"]`);if(o){o.setAttribute("aria-expanded","false");const s=o.querySelector('[data-lucide="chevron-down"]');s&&s.classList.remove("rotate-180")}})})}initializeDropdowns(){console.log("Initializing dropdowns for kepegawaian universitas..."),document.querySelectorAll("button[data-collapse-toggle]").forEach(e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}),document.querySelectorAll("button[data-collapse-toggle]").forEach(e=>{console.log("Setting up dropdown button:",e.getAttribute("data-collapse-toggle")),e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const a=this.getAttribute("data-collapse-toggle"),o=document.getElementById(a),s=this.hasAttribute("data-nested");if(console.log("Dropdown clicked:",{targetId:a,isNested:s,dropdown:o}),!o)return;const r=o.classList.contains("hidden");s?(console.log("Handling nested dropdown - only toggle this one"),r?(o.classList.remove("hidden"),o.style.maxHeight="1000px",o.style.opacity="1",console.log("Nested dropdown opened")):(o.classList.add("hidden"),o.style.maxHeight="0",o.style.opacity="0",console.log("Nested dropdown closed"))):(console.log("Handling parent dropdown - close other parents"),document.querySelectorAll(".dropdown-menu").forEach(l=>{if(l.id!==a){const d=l.querySelector(".nested-dropdown-container")!==null;if(console.log("Checking dropdown:",{id:l.id,containsNested:d,willClose:!d}),d)console.log("Kept dropdown open (contains nested):",l.id);else{l.classList.add("hidden"),l.style.maxHeight="0",l.style.opacity="0";const u=document.querySelector(`[data-collapse-toggle="${l.id}"]`);if(u){u.setAttribute("aria-expanded","false");const f=u.querySelector('[data-lucide="chevron-down"]');f&&f.classList.remove("rotate-180")}console.log("Closed dropdown:",l.id)}}}),r?(o.classList.remove("hidden"),o.style.maxHeight="2000px",o.style.opacity="1",console.log("Parent dropdown opened")):(o.classList.add("hidden"),o.style.maxHeight="0",o.style.opacity="0",console.log("Parent dropdown closed")));const i=this.querySelector('[data-lucide="chevron-down"]');i&&i.classList.toggle("rotate-180",r),this.setAttribute("aria-expanded",r?"true":"false"),console.log("Toggled dropdown:",{id:a,isNested:s,isNowOpen:r})})}),console.log("Dropdown initialization complete for kepegawaian universitas")}initializeDataTables(){typeof window.jQuery<"u"&&typeof window.jQuery.fn.DataTable<"u"?window.jQuery(".datatable").DataTable({responsive:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.24/i18n/Indonesian.json"}}):console.log("DataTables or jQuery not available")}initializeFormValidation(){document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",function(t){console.log("Form submitted:",e.action)})})}initializeFileUploads(){window.previewUploadedFile=function(n,e){const t=n.files[0],a=document.getElementById(e);if(t){if(t.type!=="application/pdf"){alert("Hanya file PDF yang diperbolehkan!"),n.value="";return}if(t.size>2097152){alert("Ukuran file maksimal 2MB!"),n.value="";return}const o=(t.size/1024/1024).toFixed(2),s=t.name;a&&(a.innerHTML=`
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center gap-3">
                                <div class="flex-shrink-0 bg-green-100 rounded-full p-2">
                                    <i data-lucide="file-check" class="w-4 h-4 text-green-600"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-green-800 truncate">${s}</p>
                                    <div class="flex items-center gap-4 mt-1">
                                        <span class="text-xs text-green-600">Ukuran: ${o} MB</span>
                                        <span class="text-xs text-green-600 flex items-center gap-1">
                                            <i data-lucide="check-circle" class="w-3 h-3"></i>
                                            Siap diupload
                                        </span>
                                    </div>
                                </div>
                                <button type="button" onclick="clearFilePreview('${n.id}', '${e}')"
                                        class="flex-shrink-0 text-green-600 hover:text-green-800">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `,a.classList.remove("hidden")),typeof lucide<"u"&&lucide.createIcons()}else a&&a.classList.add("hidden")},window.clearFilePreview=function(n,e){const t=document.getElementById(n),a=document.getElementById(e);t&&(t.value=""),a&&a.classList.add("hidden")}}initializeAlerts(){setTimeout(()=>{document.querySelectorAll(".alert").forEach(e=>{(e.classList.contains("alert-success")||e.classList.contains("alert-error"))&&(e.style.transition="opacity 0.5s ease-out",e.style.opacity="0",setTimeout(()=>e.remove(),500))})},5e3)}initializeValidationScripts(){window.showReturnForRevisionForm=function(){document.getElementById("returnForRevisionForm").classList.remove("hidden"),document.getElementById("catatan_umum_return_revision").focus()},window.hideReturnForRevisionForm=function(){document.getElementById("returnForRevisionForm").classList.add("hidden"),document.getElementById("catatan_umum_return_revision").value="",document.getElementById("charCount_return_revision").textContent="0"},window.showNotRecommendedForm=function(){document.getElementById("notRecommendedForm").classList.remove("hidden"),document.getElementById("catatan_umum_not_recommended").focus()},window.hideNotRecommendedForm=function(){document.getElementById("notRecommendedForm").classList.add("hidden"),document.getElementById("catatan_umum_not_recommended").value="",document.getElementById("charCount_not_recommended").textContent="0"},window.showSendToAssessorForm=function(){document.getElementById("sendToAssessorForm").classList.remove("hidden")},window.hideSendToAssessorForm=function(){document.getElementById("sendToAssessorForm").classList.add("hidden"),document.querySelectorAll('input[name="assessor_ids[]"]').forEach(e=>e.checked=!1),this.validateAssessorSelection()},window.showSendToSenateForm=function(){document.getElementById("sendToSenateForm").classList.remove("hidden")},window.hideSendToSenateForm=function(){document.getElementById("sendToSenateForm").classList.add("hidden")},window.showReturnForm=function(){const n=document.getElementById("returnForm"),e=document.getElementById("catatan_umum_return");if(!n){console.error("Return form not found");return}n.classList.remove("hidden"),e&&e.focus()},window.hideReturnForm=function(){const n=document.getElementById("returnForm"),e=document.getElementById("catatan_umum_return"),t=document.getElementById("charCount_return");if(!n){console.error("Return form not found");return}n.classList.add("hidden"),e&&(e.value=""),t&&(t.textContent="0")},window.validateAssessorSelection=function(){const e=document.querySelectorAll('input[name="assessor_ids[]"]:checked').length,t=document.getElementById("submitAssessorBtn"),a=document.getElementById("assessorCount");a&&(a.textContent=e),t&&(e>=1&&e<=3?(t.disabled=!1,t.classList.remove("bg-gray-300","cursor-not-allowed"),t.classList.add("bg-green-600","hover:bg-green-700")):(t.disabled=!0,t.classList.add("bg-gray-300","cursor-not-allowed"),t.classList.remove("bg-green-600","hover:bg-green-700")))},document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing form handlers...");const n=document.getElementById("returnFormSubmit");n?n.addEventListener("submit",function(r){const i=document.getElementById("catatan_umum_return");if(!i){console.error("Return form textarea not found");return}const l=i.value.trim();return l.length<10?(r.preventDefault(),alert("Catatan perbaikan harus minimal 10 karakter."),i.focus(),!1):l.length>2e3?(r.preventDefault(),alert("Catatan perbaikan maksimal 2000 karakter."),i.focus(),!1):confirm("Apakah Anda yakin ingin mengembalikan usulan ini ke pegawai untuk perbaikan?")}):console.warn("Return form submit handler not found");const e=document.getElementById("notRecommendedFormSubmit");e?e.addEventListener("submit",function(r){const i=document.getElementById("catatan_umum_not_recommended");if(!i){console.error("Not recommended form textarea not found");return}const l=i.value.trim();return l.length<10?(r.preventDefault(),alert("Alasan tidak direkomendasikan harus minimal 10 karakter."),i.focus(),!1):l.length>2e3?(r.preventDefault(),alert("Alasan tidak direkomendasikan maksimal 2000 karakter."),i.focus(),!1):confirm("Apakah Anda yakin ingin menandai usulan ini sebagai tidak direkomendasikan? Pegawai tidak dapat submit lagi di periode ini.")}):console.warn("Not recommended form submit handler not found");const t=document.getElementById("sendToAssessorFormSubmit");t?t.addEventListener("submit",function(r){const i=document.querySelectorAll('input[name="assessor_ids[]"]:checked');if(i.length<1)return r.preventDefault(),alert("Pilih minimal 1 penilai."),!1;if(i.length>3)return r.preventDefault(),alert("Pilih maksimal 3 penilai."),!1;const l=Array.from(i).map(d=>d.nextElementSibling?d.nextElementSibling.textContent:"Unknown").join(", ");return confirm(`Apakah Anda yakin ingin mengirim usulan ini ke Tim Penilai?

Penilai yang dipilih:
${l}`)}):console.warn("Send to assessor form submit handler not found");const a=document.getElementById("sendToSenateFormSubmit");a?a.addEventListener("submit",function(r){return confirm("Apakah Anda yakin ingin mengirim usulan ini ke Tim Senat untuk review final?")}):console.warn("Send to senate form submit handler not found");const o=document.getElementById("catatan_umum_return");o?o.addEventListener("input",function(){const r=this.value.length,i=document.getElementById("charCount_return");i&&(i.textContent=r)}):console.warn("Return form textarea not found for character count");const s=document.getElementById("catatan_umum_not_recommended");s?s.addEventListener("input",function(){const r=this.value.length,i=document.getElementById("charCount_not_recommended");i&&(i.textContent=r)}):console.warn("Not recommended form textarea not found for character count"),this.validateAssessorSelection(),this.initializeKepegawaianUniversitasButtons(),console.log("Form handlers initialized successfully")})}validateAssessorSelection(){const n=document.querySelectorAll('input[name="assessor_ids[]"]'),e=document.querySelector('#sendToAssessorFormSubmit button[type="submit"]');if(n.length>0&&e){const t=()=>{const a=document.querySelectorAll('input[name="assessor_ids[]"]:checked').length;e.disabled=a<1||a>3,e.textContent=a<1?"Pilih minimal 1 penilai":a>3?"Pilih maksimal 3 penilai":"Kirim ke Tim Penilai"};n.forEach(a=>{a.addEventListener("change",t)}),t()}}initializeKepegawaianUniversitasButtons(){const n=document.getElementById("btn-perbaikan-ke-pegawai");n&&n.addEventListener("click",s=>{s.preventDefault(),this.showPerbaikanModal("pegawai")});const e=document.getElementById("btn-perbaikan-ke-fakultas");e&&e.addEventListener("click",s=>{s.preventDefault(),this.showPerbaikanModal("fakultas")});const t=document.getElementById("btn-kirim-perbaikan-ke-penilai");t&&t.addEventListener("click",s=>{s.preventDefault(),this.showPerbaikanModal("penilai")});const a=document.getElementById("btn-tidak-direkomendasikan");a&&a.addEventListener("click",s=>{s.preventDefault(),this.showPerbaikanModal("tidak_direkomendasikan")});const o=document.getElementById("btn-kirim-ke-senat");o&&o.addEventListener("click",s=>{s.preventDefault(),this.showPerbaikanModal("senat")})}showPerbaikanModal(n){const e=this.getUsulanIdFromUrl();if(!e){Swal.fire({icon:"error",title:"Error",text:"Usulan ID tidak ditemukan!",confirmButtonColor:"#dc2626"});return}let t,a,o,s,r;switch(n){case"pegawai":t="Teruskan Perbaikan ke Pegawai",a="Masukkan catatan perbaikan untuk pegawai...",o=`/kepegawaian-universitas/usulan/${e}/save-validation`,s="info",r="#3b82f6";break;case"fakultas":t="Teruskan Perbaikan ke Fakultas",a="Masukkan catatan perbaikan untuk admin fakultas...",o=`/kepegawaian-universitas/usulan/${e}/save-validation`,s="info",r="#8b5cf6";break;case"penilai":t="Kirim Perbaikan ke Tim Penilai",a="Masukkan catatan perbaikan untuk tim penilai...",o=`/kepegawaian-universitas/usulan/${e}/save-validation`,s="warning",r="#f59e0b";break;case"tidak_direkomendasikan":t="Tidak Direkomendasikan",a="Masukkan alasan mengapa usulan tidak direkomendasikan...",o=`/kepegawaian-universitas/usulan/${e}/save-validation`,s="error",r="#dc2626";break;case"senat":t="Kirim ke Tim Senat",a="Masukkan catatan untuk tim senat...",o=`/kepegawaian-universitas/usulan/${e}/save-validation`,s="success",r="#059669";break}Swal.fire({icon:s,title:t,html:`
                <div class="text-left">
                    <p class="text-gray-600 mb-4">Silakan masukkan catatan atau alasan untuk tindakan ini:</p>
                </div>
            `,input:"textarea",inputPlaceholder:a,inputAttributes:{"aria-label":"Catatan perbaikan",required:"required",rows:"4",style:"min-height: 100px; resize: vertical; border-radius: 8px; border: 2px solid #e5e7eb; padding: 12px; font-size: 14px;"},showCancelButton:!0,confirmButtonText:'<i class="fas fa-paper-plane mr-2"></i>Kirim',cancelButtonText:'<i class="fas fa-times mr-2"></i>Batal',confirmButtonColor:r,cancelButtonColor:"#6b7280",showLoaderOnConfirm:!0,allowOutsideClick:()=>!Swal.isLoading(),customClass:{popup:"swal2-custom-popup",confirmButton:"swal2-confirm-custom",cancelButton:"swal2-cancel-custom",input:"swal2-input-custom"},didOpen:()=>{const i=document.createElement("style");i.textContent=`
                    .swal2-custom-popup {
                        border-radius: 16px !important;
                        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
                        animation: fadeInDown 0.3s ease-out !important;
                    }
                    .swal2-confirm-custom {
                        border-radius: 8px !important;
                        font-weight: 600 !important;
                        padding: 12px 24px !important;
                        transition: all 0.2s ease !important;
                    }
                    .swal2-confirm-custom:hover {
                        transform: translateY(-1px) !important;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
                    }
                    .swal2-cancel-custom {
                        border-radius: 8px !important;
                        font-weight: 600 !important;
                        padding: 12px 24px !important;
                        transition: all 0.2s ease !important;
                    }
                    .swal2-cancel-custom:hover {
                        transform: translateY(-1px) !important;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
                    }
                    .swal2-input-custom {
                        border-radius: 8px !important;
                        border: 2px solid #e5e7eb !important;
                        padding: 12px !important;
                        font-size: 14px !important;
                        transition: border-color 0.2s ease !important;
                    }
                    .swal2-input-custom:focus {
                        border-color: ${r} !important;
                        box-shadow: 0 0 0 3px ${r}20 !important;
                        outline: none !important;
                    }
                    @keyframes fadeInDown {
                        from {
                            opacity: 0;
                            transform: translateY(-20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                `,document.head.appendChild(i)},preConfirm:i=>!i||i.trim()===""?(Swal.showValidationMessage('<i class="fas fa-exclamation-triangle text-red-500"></i> Catatan wajib diisi'),!1):i.trim().length<10?(Swal.showValidationMessage('<i class="fas fa-exclamation-triangle text-yellow-500"></i> Catatan minimal 10 karakter'),!1):this.submitPerbaikanForm(o,i,n)}).then(i=>{i.isConfirmed})}async submitPerbaikanForm(n,e,t){var a,o;try{const s=new FormData;s.append("catatan_verifikator",e),s.append("action_type",t);const i=await(await window.fetchWithCsrf(n,{method:"POST",body:s})).json();i.success?Swal.fire({icon:"success",title:'<i class="fas fa-check-circle text-green-500"></i> Berhasil!',html:`
                        <div class="text-center">
                            <p class="text-gray-700 mb-3">Aksi telah berhasil dilakukan!</p>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-left">
                                <p class="text-sm text-green-800"><strong>Catatan yang dikirim:</strong></p>
                                <p class="text-sm text-green-700 mt-1">"${e}"</p>
                            </div>
                        </div>
                    `,timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"animated fadeInUp"}}).then(()=>{window.location.reload()}):(Swal.fire({icon:"error",title:'<i class="fas fa-exclamation-triangle text-red-500"></i> Gagal!',html:`
                        <div class="text-center">
                            <p class="text-gray-700 mb-3">${i.message||"Terjadi kesalahan saat memproses permintaan"}</p>
                            <button id="retry-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                <i class="fas fa-redo mr-2"></i>Coba Lagi
                            </button>
                        </div>
                    `,showConfirmButton:!1,customClass:{popup:"animated fadeInDown"}}),(a=document.getElementById("retry-btn"))==null||a.addEventListener("click",()=>{Swal.close(),this.submitPerbaikanForm(n,e,t)}))}catch(s){console.error("Error submitting form:",s),Swal.fire({icon:"error",title:'<i class="fas fa-exclamation-triangle text-red-500"></i> Error Koneksi!',html:`
                    <div class="text-center">
                        <p class="text-gray-700 mb-3">Terjadi kesalahan koneksi saat mengirim data</p>
                        <p class="text-sm text-gray-500 mb-3">Error: ${s.message}</p>
                        <button id="retry-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-redo mr-2"></i>Coba Lagi
                        </button>
                    </div>
                `,showConfirmButton:!1,customClass:{popup:"animated fadeInDown"}}),(o=document.getElementById("retry-btn"))==null||o.addEventListener("click",()=>{Swal.close(),this.submitPerbaikanForm(n,e,t)})}}checkAndDisableButtons(){const n=this.getUsulanDataFromPage();if(!n)return;const t=(n.validasi_data||{}).admin_universitas||{},a=["perbaikan_ke_pegawai","perbaikan_ke_fakultas"];let o=!1;a.forEach(s=>{t[s]&&(o=!0,console.log(`Found recent action: ${s}`))}),o&&["btn-perbaikan-ke-pegawai","btn-perbaikan-ke-fakultas"].forEach(r=>{const i=document.getElementById(r);i&&(i.disabled=!0,i.classList.add("opacity-50","cursor-not-allowed"),i.classList.remove("hover:bg-red-700","hover:bg-amber-700"),i.title="Button dinonaktifkan karena sudah ada aksi perbaikan yang dikirim",console.log(`Disabled button: ${r}`))})}getUsulanDataFromPage(){const n=document.querySelector("script[data-usulan]");if(n)try{return JSON.parse(n.textContent)}catch(t){console.error("Error parsing usulan data:",t)}const e=document.querySelector("[data-usulan]");if(e)try{return JSON.parse(e.getAttribute("data-usulan"))}catch(t){console.error("Error parsing usulan data from attribute:",t)}return this.extractUsulanDataFromPageContent()}extractUsulanDataFromPageContent(){const n=this.getUsulanIdFromUrl();return n?{id:n}:null}getUsulanIdFromUrl(){const e=window.location.pathname.match(/\/usulan\/(\d+)/);return e?e[1]:null}}document.addEventListener("DOMContentLoaded",function(){new p});typeof c<"u"&&c.exports&&(c.exports=p)});export default h();
