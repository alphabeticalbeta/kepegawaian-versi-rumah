document.addEventListener("DOMContentLoaded",function(){window.validateSintaUrl=function(t){const s=t.value.trim(),e=/^https?:\/\/sinta\.kemdikbud\.go\.id\/.*$/,r=t.parentElement.querySelector(".url-feedback");return s?e.test(s)?(r&&(r.textContent="URL Sinta valid",r.className="url-feedback text-xs mt-1 text-green-500"),t.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200"),t.classList.add("border-green-500","focus:border-green-500","focus:ring-green-200"),!0):(r&&(r.textContent="URL harus dari domain sinta.kemdikbud.go.id",r.className="url-feedback text-xs mt-1 text-red-500"),t.classList.add("border-red-500","focus:border-red-500","focus:ring-red-200"),t.classList.remove("border-green-500","focus:border-green-500","focus:ring-green-200"),!1):(r&&(r.textContent="",r.className="url-feedback text-xs mt-1"),t.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200","border-green-500","focus:border-green-500","focus:ring-green-200"),!0)},window.updateCharacterCount=function(t,s=500){const e=t.value.length,r=t.parentElement.querySelector(".char-counter"),n=t.parentElement.querySelector(".char-progress");if(r){if(r.textContent=`${e}/${s}`,n){const l=Math.min(e/s*100,100);n.style.width=`${l}%`}e>s?(r.classList.add("text-red-500","font-semibold"),r.classList.remove("text-orange-500","text-slate-500"),t.classList.add("border-red-500","focus:border-red-500","focus:ring-red-200"),n&&(n.classList.add("bg-red-500"),n.classList.remove("bg-orange-500","bg-green-500"))):e>s*.8?(r.classList.add("text-orange-500"),r.classList.remove("text-red-500","text-slate-500","font-semibold"),t.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200"),n&&(n.classList.add("bg-orange-500"),n.classList.remove("bg-red-500","bg-green-500"))):(r.classList.add("text-slate-500"),r.classList.remove("text-orange-500","text-red-500","font-semibold"),t.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200"),n&&(n.classList.add("bg-green-500"),n.classList.remove("bg-orange-500","bg-red-500")))}},window.autoSaveDosenData=function(){const t=document.querySelector("form");if(!t)return;const s=new FormData(t),e=document.getElementById("auto-save-indicator");e&&(e.classList.remove("hidden"),e.textContent="Menyimpan..."),fetch(t.action,{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(r=>r.json()).then(r=>{e&&(r.success?(e.textContent="Tersimpan otomatis",e.classList.add("text-green-500"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("text-green-500")},2e3)):(e.textContent="Gagal menyimpan",e.classList.add("text-red-500"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("text-red-500")},3e3)))}).catch(r=>{console.error("Auto-save error:",r),e&&(e.textContent="Gagal menyimpan",e.classList.add("text-red-500"),setTimeout(()=>{e.classList.add("hidden"),e.classList.remove("text-red-500")},3e3))})},typeof window.showToast>"u"&&(window.showToast=function(t,s="info",e=3e3){const r=document.createElement("div");r.className=`fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl transform transition-all duration-300 translate-x-full backdrop-blur-sm border ${s==="success"?"bg-green-500 text-white border-green-400":s==="error"?"bg-red-500 text-white border-red-400":s==="warning"?"bg-yellow-500 text-white border-yellow-400":"bg-blue-500 text-white border-blue-400"}`,r.innerHTML=`
                <div class="flex items-center gap-3">
                    <div class="flex-shrink-0">
                        ${s==="success"?'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>':s==="error"||s==="warning"?'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg>':'<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'}
                    </div>
                    <div class="flex-1">
                        <p class="font-medium">${t}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="flex-shrink-0 opacity-70 hover:opacity-100 transition-opacity">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `,document.body.appendChild(r),setTimeout(()=>{r.classList.remove("translate-x-full")},100),setTimeout(()=>{r.classList.add("translate-x-full"),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},300)},e)});const i=document.getElementById("url_profil_sinta"),o=document.getElementById("mata_kuliah_diampu"),a=document.getElementById("ranting_ilmu_kepakaran");if(i){const t=document.createElement("div");t.className="url-feedback text-xs mt-1",i.parentElement.appendChild(t),i.addEventListener("blur",function(){validateSintaUrl(this)}),i.addEventListener("input",function(){this.classList.contains("border-red-500")&&this.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200")});let s;i.addEventListener("input",function(){clearTimeout(s),s=setTimeout(()=>{validateSintaUrl(this)&&autoSaveDosenData()},2e3)})}if(o){const t=document.createElement("div");t.className="char-counter text-xs text-slate-500 mt-1 text-right",t.textContent="0/1000";const s=document.createElement("div");s.className="char-progress h-1 bg-green-500 rounded-full mt-1 transition-all duration-300",s.style.width="0%",o.parentElement.appendChild(t),o.parentElement.appendChild(s),o.addEventListener("input",function(){updateCharacterCount(this,1e3)});let e;o.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{autoSaveDosenData()},3e3)})}if(a){const t=document.createElement("div");t.className="char-counter text-xs text-slate-500 mt-1 text-right",t.textContent="0/500";const s=document.createElement("div");s.className="char-progress h-1 bg-green-500 rounded-full mt-1 transition-all duration-300",s.style.width="0%",a.parentElement.appendChild(t),a.parentElement.appendChild(s),a.addEventListener("input",function(){updateCharacterCount(this,500)});let e;a.addEventListener("input",function(){clearTimeout(e),e=setTimeout(()=>{autoSaveDosenData()},3e3)})}const d=document.querySelector("form");d&&d.addEventListener("submit",function(t){var n;let s=!0;const e=[];if(i&&i.value&&(validateSintaUrl(i)||(s=!1,e.push("URL Profil Sinta tidak valid"))),((n=document.querySelector('select[name="jenis_pegawai"]'))==null?void 0:n.value)==="Dosen"&&(o&&!o.value.trim()?(o.classList.add("border-red-500","focus:border-red-500","focus:ring-red-200"),s=!1,e.push("Mata Kuliah yang Diampu wajib diisi untuk Dosen")):o&&o.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200"),a&&!a.value.trim()?(a.classList.add("border-red-500","focus:border-red-500","focus:ring-red-200"),s=!1,e.push("Ranting Ilmu/Kepakaran wajib diisi untuk Dosen")):a&&a.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-200")),!s){t.preventDefault(),showToast(e.join(", "),"error");const l=document.querySelector(".border-red-500");l&&l.scrollIntoView({behavior:"smooth",block:"center"})}});const c=document.createElement("div");c.id="auto-save-indicator",c.className="hidden text-xs text-slate-500 mt-2 text-center",c.textContent="Tersimpan otomatis";const u=d==null?void 0:d.parentElement;u&&u.appendChild(c),o&&updateCharacterCount(o,1e3),a&&updateCharacterCount(a,500)});
